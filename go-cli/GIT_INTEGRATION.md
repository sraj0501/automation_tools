# Git Integration Module

This module provides Git repository monitoring and commit detection for the DevTrack automation system.

## Features

### ‚úÖ Implemented

- **Git Repository Monitoring**: Real-time detection of commits using fsnotify
- **Commit Information Extraction**: Hash, message, author, timestamp, and changed files
- **Post-Commit Hook Installation**: Automatic hook generation for repository setup
- **Configuration Management**: YAML-based config for repositories and settings
- **Multi-Repository Support**: Monitor multiple repositories simultaneously

### üéØ Core Components

1. **`git_monitor.go`**: Main Git monitoring implementation
   - `GitMonitor`: Watches .git directory for changes
   - `CommitInfo`: Structured commit data
   - Real-time commit detection using file system events
   - Changed files tracking

2. **`config.go`**: Configuration management
   - YAML-based configuration (`~/.devtrack/config.yaml`)
   - Repository settings
   - Integration settings (Azure DevOps, GitHub, JIRA)
   - Work hours and timezone configuration

3. **`demo.go`**: Test and demonstration utilities
   - Git monitor testing
   - Configuration testing
   - Example implementations

## Usage

### Test Git Monitoring

```bash
cd go-cli
go run . test-git
```

This will:
- Start monitoring the current repository
- Detect commits in real-time
- Display commit information
- Show next steps for automation

### Test Configuration

```bash
go run . test-config
```

This will:
- Load or create default configuration
- Display settings and repositories
- Show integration status

### Configuration File

The configuration is stored at `~/.devtrack/config.yaml`:

```yaml
version: 1.0.0
repositories:
  - name: automation_tools
    path: /Users/shashank_raj2/git_apps/personal/automation_tools
    enabled: true
    project: DevTrack
    ignore: []

settings:
  prompt_interval: 180  # 3 hours in minutes
  work_hours_only: false
  work_start_hour: 9
  work_end_hour: 18
  timezone: Asia/Kolkata
  log_level: info
  auto_sync: true

integrations:
  azure_devops:
    enabled: true
    organization: ""
    project: ""
    pat: ${AZURE_DEVOPS_PAT}
  github:
    enabled: true
    owner: ""
    repo: ""
    token: ${GITHUB_TOKEN}
  jira:
    enabled: false
    url: ""
    project: ""
    username: ""
    api_token: ${JIRA_API_TOKEN}
```

## How It Works

### Commit Detection Flow

1. **Monitor .git Directory**: Uses fsnotify to watch for file changes
2. **Detect Write Events**: Filters relevant git operations
3. **Extract Commit Info**: Uses go-git to parse commit data
4. **Trigger Callback**: Notifies the system of new commits
5. **Next Steps** (to be implemented):
   - Send to IPC layer
   - Prompt user for details
   - Parse with NLP
   - Update project management tools

### Post-Commit Hook

The module can install a post-commit hook:

```bash
#!/bin/sh
# Auto-generated by devtrack
echo "Commit detected at $(date)" >> ~/.devtrack/commit.log
exit 0
```

This will be enhanced to communicate with the daemon via IPC.

## Integration Points

### Current Status
- ‚úÖ Git monitoring implemented
- ‚úÖ Configuration system ready
- ‚úÖ Multi-repository support
- ‚è≥ IPC communication (next step)
- ‚è≥ Daemon integration (next step)
- ‚è≥ Python bridge (next step)

### Next Steps
1. Implement IPC layer for Go ‚Üî Python communication
2. Create daemon process for background monitoring
3. Connect to scheduler for time-based triggers
4. Integrate with Python NLP parser
5. Add SQLite logging

## API Reference

### GitMonitor

```go
// Create a new Git monitor
monitor, err := NewGitMonitor("/path/to/repo")

// Start monitoring with callback
monitor.Start(func(commit CommitInfo) {
    fmt.Printf("New commit: %s\n", commit.Hash)
    // Handle commit event
})

// Stop monitoring
monitor.Stop()
```

### Config

```go
// Load configuration
config, err := LoadConfig()

// Add repository
config.AddRepository("myrepo", "/path/to/repo", "ProjectName")

// Save configuration
config.Save()

// Get enabled repositories
repos := config.GetEnabledRepositories()
```

## Dependencies

- `github.com/go-git/go-git/v5`: Git operations
- `github.com/fsnotify/fsnotify`: File system watching
- `gopkg.in/yaml.v3`: YAML configuration

## Testing

Run the demos to test functionality:

```bash
# Test Git monitoring (make a commit while running)
go run . test-git

# Test configuration
go run . test-config

# Build the module
go build
```

## Future Enhancements

- [ ] Branch change detection
- [ ] Support for multiple remotes
- [ ] Stash detection
- [ ] Tag creation monitoring
- [ ] Performance optimization for large repos
- [ ] Configurable file patterns to ignore
- [ ] Integration with GitHub/GitLab/Bitbucket webhooks
